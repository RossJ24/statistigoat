---
title: "StatistiGoat"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Load lbraries
library(dplyr)
source("http://www.reuningscherer.net/s&ds230/Rfuncs/regJDRS.txt")

# Load datasets
szn_stats <- read.csv("./Seasons_Stats.csv")
player_data <- read.csv("./player_data.csv")

# Add new variables to reflect per game statistics
szn_stats$PPG <- szn_stats$PTS/szn_stats$G
szn_stats$ORPG <- szn_stats$ORB/szn_stats$G
szn_stats$DRPG <- szn_stats$DRB/szn_stats$G
szn_stats$APG <- szn_stats$AST/szn_stats$G
szn_stats$BPG <- szn_stats$BLK/szn_stats$G
szn_stats$TPG <- szn_stats$TOV/szn_stats$G
# Make copy of szn stats to compute Goat Rating (GR) variable
szn_stats_gr <- szn_stats
szn_stats_gr[is.na(szn_stats)] <- 0 

# Add Goat Rating column to our season stats dataframe
szn_stats_gr$GR <- (2.0 *szn_stats_gr$PPG) + ((4/5)*szn_stats_gr$DRPG) + szn_stats_gr$ORPG + (1.5 * szn_stats_gr$APG) + (szn_stats_gr$PER - (1.5 *szn_stats_gr$TPG)) + szn_stats_gr$BPG + (10.0 * szn_stats_gr$TS.)
szn_stats$GR <- szn_stats_gr$GR

# Dataframe of strictly numbers (Got rid of character vectors) might be deleted
szn_nums <- szn_stats
szn_nums$Tm <- NULL
szn_nums$Player<- NULL
szn_nums$Pos <- NULL


```


```{r}
# Extract era statistics here
# Get rid of people in ERA 1 who didn't have a player efficiency rating.
era1 <- szn_stats[which(szn_stats$Year <= 1965),]
era1 <- era1[!is.na(era1$PER), ]

era2 <- szn_stats[which(szn_stats$Year > 1965 & szn_stats$Year <= 1980),]

era3 <- szn_stats[which(szn_stats$Year > 1980 & szn_stats$Year <= 1990),]

era4 <- szn_stats[which(szn_stats$Year > 1990 & szn_stats$Year <= 2000),]

era5 <- szn_stats[which(szn_stats$Year > 2000 & szn_stats$Year <= 2010),]

era6 <- szn_stats[which(szn_stats$Year > 2010),]

```

*We split up the eras using larger periods (15 years) in the first two eras when the league was smaller, and decreased it to 10 for all eras up until 2010 when we used the remaining years of the dataset until 2017 to form our final era.*


```{r}
get_player_avgs <- function(eradf){
  ret <- eradf %>% 
  group_by(Player) %>% 
  summarise(aPPG = mean(PPG, na.rm = T), aAPG = mean(APG, na.rm = T), aORPG = mean(ORPG, na.rm = T), aDRPG = mean(DRPG, na.rm = T), aBPG = mean(BPG, na.rm = T), aTPG = mean(TPG, na.rm = T), aTSP = mean(TS., na.rm = T), aPER = mean(PER, na.rm = T), aGR = mean(GR, na.rm = T), aUSG = mean(USG., na.rm = T), aOWS = mean(OWS, na.rm = T), aDWS = mean(DWS, na.rm = T), aVORP = mean(VORP, na.rm = T))
  return(ret)
}


era1pavgs <- get_player_avgs(era1)
era2pavgs <- get_player_avgs(era2)
era3pavgs <- get_player_avgs(era3)
era4pavgs <- get_player_avgs(era4)
era5pavgs <- get_player_avgs(era5)
era6pavgs <- get_player_avgs(era6)
szn_statspavgs <- get_player_avgs(szn_stats)
szn_statspavgs <- szn_statspavgs[-1, ]
```


```{r}

# Make boxplots of the variables we are considering to show why we need to adjust
#Points Boxplot

boxplot(era1pavgs$aGR, era2pavgs$aGR, era3pavgs$aGR, era4pavgs$aGR, era5pavgs$aGR, era6pavgs$aGR, main ="GOAT Rating by Era", names = c("1950-1965", "1966-1980", "1981-1990", "1991-2000", "2001-2010", "2011-2017"), las = 2)
```

*In the boxplots shown above, the IQRS are all roughly the same for all eras. However, there are a large amount of outliers of the boxplot. Since our purpose involves analyzing the best players of each era, it might be best to consider only the players that are at the top of their era in terms of PPG.*


```{r}
# Got rid of all players that do not have a PPG above or at the 95th percentile since it is reasonable to expect a potential GOAT to score at a high level

get_rid_of_bums_avg <- function(df){
  tmp <- df[df$aPPG >= quantile(df$aPPG, prob= 0.95), ]
  return(tmp)
}

era1nb <- get_rid_of_bums_avg(era1pavgs)
era2nb <- get_rid_of_bums_avg(era2pavgs)
era3nb <- get_rid_of_bums_avg(era3pavgs)
era4nb <- get_rid_of_bums_avg(era4pavgs)
era5nb <- get_rid_of_bums_avg(era5pavgs)
era6nb <- get_rid_of_bums_avg(era6pavgs)
szn_statsnb <- get_rid_of_bums_avg(szn_statspavgs)
szn_statsnb[which(szn_statsnb$aGR == max(szn_statsnb$aGR)), ]
```

```{r}
#to put to rest: do different eras have different levels of competition? pair with ANOVA to answer this 
boxplot(era1nb$aGR, era2nb$aGR, era3nb$aGR, era4nb$aGR, era5nb$aGR, era6nb$aGR, main ="GOAT Rating by Era (Without bums)", names = c("1950-1965", "1966-1980", "1981-1990", "1991-2000", "2001-2010", "2011-2017"), las = 2)


```

*After getting rid of bums, it is easier to see the actual difference in Goat Rating between the top players of each era.*

```{r}
# New dataset for ANOVA by era
firstera <- era1
firstera$Era <- 1

secondera <- era2
secondera$Era <- 2

thirdera <- era3
thirdera$Era <- 3

fourthera <- era4
fourthera$Era <- 4

fifthera <- era5
fifthera$Era <- 5

sixthera <- era6
sixthera$Era <- 6

# Bind the era dataframes together
alleras <- rbind(firstera, secondera, thirdera, fourthera, fifthera, sixthera)

alleras <- alleras[, c(3, 60, 61, 54)]
alleras <- alleras %>% 
  group_by(Player) %>% 
  summarise(aGR = mean(GR, na.rm = TRUE), era = round(mean(Era, na.rm = TRUE), digits = 0), aPPG = mean(PPG,na.rm =  T))

alleras <- alleras[-1, ]

alleras_nb <- get_rid_of_bums_avg(alleras)

alleras_nb$era <- factor(alleras_nb$era, labels = c("1", "2", "3", "4", "5", "6"))

aov1 <- aov(aGR ~ era, data = alleras_nb)

summary(aov1)

TukeyHSD(aov1)

# Gives SIMULTANEOUS 95% CI's for the 10 differences in means.
plot(TukeyHSD(aov1))

#Fix axes
plot(TukeyHSD(aov1), las = 1)

mod3 <- lm(aGR ~ era, data = alleras_nb)

myResPlots(mod3, label = "Player GOAT Rating by Era")
```
**


```{r}
#scatterplots plotting each variable versus GR

szn_statsnb$aVORP[szn_statsnb$aVORP == 0] <- NA
szn_statsnb$aUSG[szn_statsnb$aUSG == 0] <- NA
set.seed(230)
myCor <- function(x, y, w, z){
  #make the scatterplot
  plot(x, y, pch = 19, col = "red", xlab = w, ylab = z)
  #add text in the margin reporting the sample correlation)
  mtext(paste("Sample Correlation =", round(cor(x, y, use = "pairwise.complete.obs"), 3)), cex = 1.2)
}

myCor(szn_statsnb$aPER, szn_statsnb$aGR, "PER", "GR")
myCor(szn_statsnb$aOWS, szn_statsnb$aGR, "OWS", "GR")
myCor(szn_statsnb$aDWS, szn_statsnb$aGR, "DWS", "GR")
myCor(szn_statsnb$aVORP, szn_statsnb$aGR, "VORP", "GR")
myCor(szn_statsnb$aUSG, szn_statsnb$aGR, "USG", "GR")
```


```{r}
#bootstrapping the correlations between each advanced stat variable and GOAT Rating(GR)

N <- nrow(szn_statsnb)

n_samp <- 10000

corResultsPER <- rep(NA, n_samp)
corResultsVORP <- rep(NA, n_samp)
corResultsOWS <- rep(NA, n_samp)
corResultsDWS <- rep(NA, n_samp)
corResultsUSG <- rep(NA, n_samp)

for(i in 1:n_samp){
  
  s <- sample(1:N, N , replace = T)
  fakeData <-  szn_statsnb[s, ]
    
  corResultsPER[i] <- cor(fakeData[, 10], fakeData[, 9], use = "pairwise.complete.obs")
  corResultsVORP[i] <- cor(fakeData[, 10], fakeData[, 14], use = "pairwise.complete.obs")
  corResultsOWS[i] <- cor(fakeData[, 10], fakeData[, 12], use = "pairwise.complete.obs")
  corResultsDWS[i] <- cor(fakeData[, 10], fakeData[, 13], use = "pairwise.complete.obs")
  corResultsUSG[i] <- cor(fakeData[, 10], fakeData[, 11], use = "pairwise.complete.obs")

}

#histograms of bootstrapped correlations with confidence intervals
ci_rPER <- quantile(corResultsPER, c(.025, .975))
hist(corResultsPER, col = "blue", main = "Bootstrapped PER Correlations", xlab = "Sample Correlation", breaks = 50)

abline(v = ci_rPER, lwd = 3, col = "red")
abline(v = cor.test(szn_statsnb$aGR, szn_statsnb$aPER)$conf.int, lwd = 3, col = "green", lty = 2)
legend("topleft", c("Theoretical CI","Boot CI"), lwd = 3, col = c("green","red"), lty = c(2, 1))


ci_rVORP <- quantile(corResultsVORP, c(.025, .975))
hist(corResultsVORP, col = "blue", main = "Bootstrapped VORP Correlations", xlab = "Sample Correlation", breaks = 50)

abline(v = ci_rVORP, lwd = 3, col = "red")
abline(v = cor.test(szn_statsnb$aGR, szn_statsnb$aVORP)$conf.int, lwd = 3, col = "green", lty = 2)
legend("topleft", c("Theoretical CI","Boot CI"), lwd = 3, col = c("green","red"), lty = c(2, 1))


ci_rOWS <- quantile(corResultsOWS, c(.025, .975))
hist(corResultsOWS, col = "blue", main = "Bootstrapped OWS Correlations", xlab = "Sample Correlation", breaks = 50)

abline(v = ci_rOWS, lwd = 3, col = "red")
abline(v = cor.test(szn_statsnb$aGR, szn_statsnb$aOWS)$conf.int, lwd = 3, col = "green", lty = 2)
legend("topleft", c("Theoretical CI","Boot CI"), lwd = 3, col = c("green","red"), lty = c(2, 1))


ci_rDWS <- quantile(corResultsDWS, c(.025, .975))
hist(corResultsDWS, col = "blue", main = "Bootstrapped DWS Correlations", xlab = "Sample Correlation", breaks = 50)

abline(v = ci_rDWS, lwd = 3, col = "red")
abline(v = cor.test(szn_statsnb$aGR, szn_statsnb$aDWS)$conf.int, lwd = 3, col = "green", lty = 2)
legend("topleft", c("Theoretical CI","Boot CI"), lwd = 3, col = c("green","red"), lty = c(2, 1))


ci_rUSG <- quantile(corResultsUSG, c(.025, .975))
hist(corResultsUSG, col = "blue", main = "Bootstrapped USG Correlations", xlab = "Sample Correlation", breaks = 50)

abline(v = ci_rUSG, lwd = 3, col = "red")
abline(v = cor.test(szn_statsnb$aGR, szn_statsnb$aUSG)$conf.int, lwd = 3, col = "green", lty = 2)
legend("topleft", c("Theoretical CI","Boot CI"), lwd = 3, col = c("green","red"), lty = c(2, 1))
```

**


```{r}
#Permutation tests on TS and PER between season stats before 1980 and season stats after 1980
set.seed(230)
avgdiff <- vector(10000, mode = "numeric")

tmpszn <- szn_stats[!is.na(szn_stats$PER), ]
actualdiff <- mean(tmpszn$PER[tmpszn$Year <= 1980]) - mean(tmpszn$PER[tmpszn$Year > 1980 ])

for(i in 1:10000){
  fakeyear <- sample(tmpszn$Year)
  avgdiff[i] <- mean(tmpszn$PER[fakeyear <= 1980]) - mean(tmpszn$PER[fakeyear > 1980 ])
  
}

#Add something to make the abline show
hist(avgdiff, col= "blue", xlim = c(-.7, .7), main="Permuted Sample Differences")
abline(v= actualdiff, col = "green", lwd = 3)
text(actualdiff,0, paste("Actual Difference in means =", round(actualdiff, 3)), srt = 90, adj = 0)
actualdiff
mean(abs(avgdiff) >= abs(actualdiff))
```


```{r}
#Permutation tests continued
set.seed(230)
avgdiff <- vector(10000, mode = "numeric")
tmpszn <- szn_stats[!is.na(szn_stats$TS.), ]
actualdiff <- mean(tmpszn$TS.[tmpszn$Year <= 1980] *100) - mean(tmpszn$TS.[tmpszn$Year > 1980 ]*100)

for(i in 1:10000){
  fakeyear <- sample(tmpszn$Year)
  avgdiff[i] <- mean(tmpszn$TS.[fakeyear <= 1980]*100) - mean(tmpszn$TS.[fakeyear > 1980 ]*100)
  
}

#Add something to make the abline show
hist(avgdiff, col= "blue", xlim = c(-7, 7), main="Permuted Sample Differences")
abline(v= actualdiff, col = "green", lwd = 3)
text(actualdiff,0, paste("Actual Differences in Means =", round(actualdiff, 3)), srt = 90, adj = 0)
actualdiff
mean(abs(avgdiff) >= abs(actualdiff))
```

```{r}
#multiple regression

#get version of szn_statsnb that only has complete cases. reorder so that GR is first column
szn_statsnb2 <- szn_statsnb[complete.cases(szn_statsnb), ]
szn_statsnb2 <- szn_statsnb2[,-1]
szn_statsnb2 <- szn_statsnb2[, c(9, 8, 10, 11, 12, 13)]

pairsJDRS(szn_statsnb2)
#some evidence of multicollinearity between the variables present. VORP is correlated to DWS, OWS, and PER. PER is correlated to all other variables. Perhaps we should delete VORP and PER?
```


```{r}
#make a model using all predictors

lm1 <- lm(aGR ~ aPER + aVORP + aOWS + aDWS + aUSG, data=szn_statsnb2)
summary(lm1)
myResPlots2(lm1, label = "Model with All Predictors")
```

```{r}
library(leaps)
#use best subsets to find best models

mod1 <- regsubsets(aGR ~ ., data = szn_statsnb2, nvmax = 5)

mod1sum <- summary(mod1)


#find what number of variables give the best model according to BIC
which.min(mod1sum$bic)

#Which variables are in model 2
names(szn_statsnb2)[mod1sum$which[which.min(mod1sum$bic), ]][-1]

#Fit this model and show results
temp <- szn_statsnb2[,mod1sum$which[which.min(mod1sum$bic), ]]
myResPlots2(lm(log(temp$aGR) ~ ., data = temp))
summary(lm(aGR ~ ., data = temp))
```


```{r}
#try to fit a model without VORP and PER to see if that helps get rid of multicollinearity

#get version of szn_statsnb that only has complete cases. reorder so that GR is first column
szn_statsnb3 <- szn_statsnb[complete.cases(szn_statsnb), ]
szn_statsnb3 <- szn_statsnb3[,-1]
szn_statsnb3 <- szn_statsnb3[, c(9, 10, 11, 12)]

pairsJDRS(szn_statsnb3)
#less evidence of multicollinearity now

```

```{r}
lm2 <- lm(aGR ~ aOWS + aDWS + aUSG, data=szn_statsnb3)
summary(lm2)

myResPlots2(lm2)
```

```{r}
mod2 <- regsubsets(aGR ~ ., data = szn_statsnb3, nvmax = 3)

mod2sum <- summary(mod2)
summary(mod2)
which.min(mod2sum$bic)

#since all variables are in this, it is the same as the original model
names(szn_statsnb3)[mod2sum$which[which.min(mod2sum$bic), ]][-1]

```

```{r}
#final model 
finalmod <- summary(lm(aGR ~ ., data = temp))
finalmod
```

**

```{r}
#use t test to see whether the Lakers or the Celtics have had better players over the years by GR to see which is the better franchise since they have won the same number of championships

szn_statsBOS <- szn_stats[which(szn_stats$Tm == "BOS"),]

szn_statsLAL <- szn_stats[which(szn_stats$Tm == "LAL"),]

szn_statsBOS <- get_player_avgs(szn_statsBOS)

szn_statsLAL <- get_player_avgs(szn_statsLAL)

szn_statsBOS$Team <- "BOS"
szn_statsLAL$Team <- "LAL"

szn_statsBOSLAL <- rbind(szn_statsBOS, szn_statsLAL)

test1 <- t.test(aGR ~ Team, data = szn_statsBOSLAL)
tapply(szn_statsBOSLAL$aGR, szn_statsBOSLAL$Team, mean)
test1$conf.int 
test1$p.value

#fail to reject the null that the difference in mean GRs of BOS and LAL is zero with a alpha of 0.05. conclusion: there is no significant difference therefore the teams are the same level of greatness.
```


```{r}
#standard deviation

#player compared to era
era_1 <- szn_stats[szn_stats$Year <= 1965, ]
era_1 <- era_1[!is.na(era_1$PER), ]

era_1_russell <- era_1[era_1$Player == "Bill Russell*",]
era_1_notrussell <- era_1[era_1$Player != "Bill Russell*",]

era_1_russell_gr <- mean(era_1_russell$GR)

era_1_notrussell_gr <- mean(era_1_notrussell$GR)


russel_compared_to_rest <- era_1_russell_gr/era_1_notrussell_gr


era_2 <- szn_stats[(szn_stats$Year > 1965 & szn_stats$Year <= 1980),]

era_2_wilt <-  era_2[era_2$Player == "Wilt Chamberlain*",]
era_2_notwilt <- era_2[era_2$Player != "Wilt Chamberlain*",]

era_2_wilt_gr <- mean(era_2_wilt$GR)

era_2_notwilt_gr <- mean(era_2_notwilt$GR)

wilt_compared_to_rest <- era_2_wilt_gr/era_2_notwilt_gr




era_2_kareem <-  era_2[era_2$Player == "Kareem Abdul-Jabbar*",]
era_2_notkareem <- era_2[era_2$Player != "Kareem Abdul-Jabbar*",]

era_2_kareem_gr <- mean(era_2_kareem$GR)

era_2_notkareem_gr <- mean(era_2_notkareem$GR)

kareem_compared_to_rest <- era_2_kareem_gr/era_2_notkareem_gr


era_3 <- szn_stats[szn_stats$Year > 1980 & szn_stats$Year <= 1990 ,]

era_3_magic <- era_3[era_3$Player == "Magic Johnson*",]
era_3_notmagic <- era_3[era_3$Player != "Magic Johnson*",]

era_3_magic_gr <- mean(era_3_magic$GR)

era_3_notmagic_gr <- mean(era_3_notmagic$GR)

magic_compared_to_rest <- era_3_magic_gr/era_3_notmagic_gr


era_3_bird <- era_3[era_3$Player == "Larry Bird*",]
era_3_notbird <- era_3[era_3$Player != "Larry Bird*",]

era_3_bird_gr <- mean(era_3_bird$GR)

era_3_notbird_gr <- mean(era_3_notbird$GR)

bird_compared_to_rest <- era_3_bird_gr/era_3_notbird_gr


era_4 <- szn_stats[szn_stats$Year > 1990 & szn_stats$Year <= 2000 ,]

era_4_mj <-  era_4[era_4$Player == "Michael Jordan*",]
era_4_notmj <- era_4[era_4$Player != "Michael Jordan*",]

era_4_mj_gr <- mean(era_4_mj$GR)

era_4_notmj_gr <- mean(era_4_notmj$GR)

mj_compared_to_rest <- era_4_mj_gr/era_4_notmj_gr


era_4_shaq <-  era_4[era_4$Player == "Shaquille O'Neal*",]
era_4_notshaq <- era_4[era_4$Player != "Shaquille O'Neal*",]

era_4_shaq_gr <- mean(era_4_shaq$GR)

era_4_notshaq_gr <- mean(era_4_notshaq$GR)

shaq_compared_to_rest <- era_4_shaq_gr/era_4_notshaq_gr


era_5 <- szn_stats[szn_stats$Year > 2000 & szn_stats$Year <= 2010 ,]

era_5_td <-  era_5[era_5$Player == "Tim Duncan",]
era_5_nottd <- era_5[era_5$Player != "Tim Duncan",]

era_5_td_gr <- mean(era_5_td$GR)

era_5_nottd_gr <- mean(era_5_nottd$GR)

td_compared_to_rest <- era_5_td_gr/era_5_nottd_gr

era_5_kobe <-  era_5[era_5$Player == "Kobe Bryant",]
era_5_notkobe <- era_5[era_5$Player != "Kobe Bryant",]

era_5_kobe_gr <- mean(era_5_kobe$GR)

era_5_notkobe_gr <- mean(era_5_notkobe$GR)

kobe_compared_to_rest <- era_5_kobe_gr/era_5_notkobe_gr


era_6 <- szn_stats[szn_stats$Year > 2010,]

era_6_lbj <-  era_5[era_5$Player == "LeBron James",]
era_6_notlbj <- era_5[era_5$Player != "LeBron James",]

era_6_lbj_gr <- mean(era_6_lbj$GR)

era_6_notlbj_gr <- mean(era_6_notlbj$GR)

lbj_compared_to_rest <- era_6_lbj_gr/era_6_notlbj_gr

russel_sd <- (era_1_russell_gr - mean(era1$GR))/sd(era1$GR) 
wilt_sd <- (era_2_wilt_gr - mean(era2$GR))/sd(era2$GR) 

kareem_sd <- (era_2_kareem_gr - mean(era2$GR))/sd(era2$GR) 

magic_sd <- (era_3_magic_gr - mean(era3$GR))/sd(era3$GR)

bird_sd <- (era_3_bird_gr - mean(era3$GR))/sd(era3$GR)

mj_sd <- (era_4_mj_gr - mean(era4$GR))/sd(era4$GR)

shaq_sd <- (era_4_shaq_gr - mean(era4$GR))/sd(era4$GR)

td_sd <- (era_5_td_gr - mean(era5$GR))/sd(era5$GR)

kobe_sd <- (era_5_kobe_gr - mean(era5$GR))/sd(era5$GR)

lbj_sd <- (era_6_lbj_gr - mean(era6$GR))/sd(era6$GR)

player_enum <- c(1:10)
playersds <-  c(russel_sd, wilt_sd, kareem_sd, magic_sd, bird_sd, mj_sd, shaq_sd, td_sd, kobe_sd, lbj_sd)
player_names <- c("russel", "wilt", "kareem", "magic", "bird", "jordan", "shaq", "duncan", "kobe", "lebron")
plot(playersds~player_enum, pch = 19, col = "red", ylab= "", xlab="# of player")
text(playersds~player_enum, labels=player_names, cex=0.9, font=2)
```


**

```{r}
kobe_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Kobe Bryant"),]
kobe_peak <- kobe_peak[which.max(kobe_peak$GR),]
#kobe_peak

kobe_teammates <- szn_stats_gr[which(szn_stats_gr$Year == "2006" & szn_stats_gr$Tm == "LAL"  & szn_stats_gr$Player != "Kobe Bryant"),]
#kobe_teammates
kobe_gr <- mean(kobe_peak$GR)
kobe_team_gr <- mean(kobe_teammates$GR)
kobe_adjusted_gr <- kobe_gr - kobe_team_gr
tmac_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Tracy McGrady"),]
tmac_peak <- tmac_peak[which.max(tmac_peak$GR),]
#tmac_peak
tmac_teammates <- szn_stats_gr[which(szn_stats_gr$Year == "2003" & szn_stats_gr$Tm == "ORL"  & szn_stats_gr$Player != "Tracy McGrady"),]
tmac_gr <- mean(tmac_peak$GR)
tmac_team_gr <- mean(tmac_teammates$GR)
tmac_adjusted_gr <- tmac_gr - tmac_team_gr
#tmac_teammates


lebron_peak <- szn_stats_gr[which(szn_stats_gr$Player == "LeBron James"),]
lebron_peak <- lebron_peak[which.max(lebron_peak$GR),]
#lebron_peak
lebron_teammates <- szn_stats_gr[which(szn_stats_gr$Year == 2010 & szn_stats_gr$Tm == "CLE"  & szn_stats_gr$Player != "LeBron James"),]
#lebron_teammates
lebron_gr <- mean(lebron_peak$GR)
lebron_team_gr <- mean(lebron_teammates$GR)
lebron_adjusted_gr <- lebron_gr - lebron_team_gr


durant_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Kevin Durant"),]
durant_peak <- durant_peak[which.max(durant_peak$GR),]
#durant_peak
durant_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 2014 & szn_stats_gr$Tm == "OKC"  & szn_stats_gr$Player != "Kevin Durant"),]
#durant_teammates
durant_gr <- mean(durant_peak$GR)
durant_team_gr <- mean(durant_teammates$GR)
durant_adjusted_gr <- durant_gr - durant_team_gr



jordan_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Michael Jordan*"),]
jordan_peak <- jordan_peak[which.max(jordan_peak$GR),]
#jordan_peak
jordan_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1988 & szn_stats_gr$Tm == "CHI"  & szn_stats_gr$Player != "Michael Jordan*"),]
#jordan_teammates
jordan_gr <- mean(jordan_peak$GR)
jordan_team_gr <- mean(jordan_teammates$GR)
jordan_adjusted_gr <- jordan_gr - jordan_team_gr

barkley_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Charles Barkley*"),]
barkley_peak <- barkley_peak[which.max(barkley_peak$GR),]
#barkley_peak
barkley_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1988 & szn_stats_gr$Tm == "PHI"  & szn_stats_gr$Player != "Charles Barkley*"),]
#barkley_teammates
barkley_gr <- mean(barkley_peak$GR)
barkley_team_gr <- mean(barkley_teammates$GR)
barkley_adjusted_gr <- barkley_gr - barkley_team_gr



chamberlain_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Wilt Chamberlain*"),]
chamberlain_peak <- chamberlain_peak[which.max(chamberlain_peak$GR),]
#chamberlain_peak
chamberlain_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1962 & szn_stats_gr$Tm == "PHW"  & szn_stats_gr$Player != "Wilt Chamberlain*"),]
#chamberlain_teammates
chamberlain_gr <- mean(chamberlain_peak$GR)
chamberlain_team_gr <- mean(chamberlain_teammates$GR)
chamberlain_adjusted_gr <- chamberlain_gr - chamberlain_team_gr
russell_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Bill Russell*"),]
russell_peak <- russell_peak[which.max(russell_peak$GR),]
#russell_peak
russell_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1962 & szn_stats_gr$Tm == "BOS"  & szn_stats_gr$Player != "Bill Russell*"),]
#russell_teammates
russell_gr <- mean(russell_peak$GR)
russell_team_gr <- mean(russell_teammates$GR)
russell_adjusted_gr <- russell_gr - russell_team_gr

kareem_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Kareem Abdul-Jabbar*"),]
kareem_peak <- kareem_peak[which.max(kareem_peak$GR),]
#kareem_peak
kareem_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1976 & szn_stats_gr$Tm == "LAL"  & szn_stats_gr$Player != "Kareem Abdul-Jabbar*"),]
#kareem_teammates
kareem_team_gr <- mean(kareem_teammates$GR)
kareem_gr <- mean(kareem_peak$GR)
kareem_adjusted_gr <- kareem_gr - kareem_team_gr

hayes_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Elvin Hayes*"),]
hayes_peak <- hayes_peak[which.max(hayes_peak$GR),]
#hayes_peak
hayes_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1977 & szn_stats_gr$Tm == "WSB"  & szn_stats_gr$Player != "Elvin Hayes*"),]
#hayes_teammates
hayes_gr <- mean(hayes_peak$GR)
hayes_team_gr <- mean(hayes_teammates$GR)
hayes_adjusted_gr <- hayes_gr - hayes_team_gr

magic_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Magic Johnson*"),]
magic_peak <- magic_peak[which.max(magic_peak$GR),]
#magic_peak
magic_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1987 & szn_stats_gr$Tm == "LAL"  & szn_stats_gr$Player != "Magic Johnson*"),]
#magic_teammates
magic_gr <- mean(magic_peak$GR)
magic_team_gr <- mean(magic_teammates$GR)
magic_adjusted_gr <- magic_gr - magic_team_gr
bird_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Larry Bird*"),]
bird_peak <- bird_peak[which.max(bird_peak$GR),]
#bird_peak
bird_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1988 & szn_stats_gr$Tm == "BOS"  & szn_stats_gr$Player != "Larry Bird*"),]
#bird_teammates
bird_gr <- mean(bird_peak$GR)
bird_team_gr <- mean(bird_teammates$GR)
bird_adjusted_gr <- bird_gr - bird_team_gr

duncan_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Tim Duncan"),]
duncan_peak <- duncan_peak[which.max(duncan_peak$GR),]
#duncan_peak
duncan_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 2002 & szn_stats_gr$Tm == "SAS"  & szn_stats_gr$Player != "Tim Duncan"),]
#duncan_teammates
duncan_gr <- mean(duncan_peak$GR)
duncan_team_gr <- mean(duncan_teammates$GR)
duncan_adjusted_gr <- duncan_gr - duncan_team_gr

dirk_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Dirk Nowitzki"),]
dirk_peak <- dirk_peak[which.max(dirk_peak$GR),]
#dirk_peak
dirk_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 2006 & szn_stats_gr$Tm == "DAL"  & szn_stats_gr$Player != "Dirk Nowitzki"),]
#dirk_teammates
dirk_gr <- mean(dirk_peak$GR)
dirk_team_gr <- mean(dirk_teammates$GR)
dirk_adjusted_gr <- dirk_gr - dirk_team_gr

shaq_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Shaquille O'Neal*"),]
shaq_peak <- shaq_peak[which.max(shaq_peak$GR),]
#shaq_peak
shaq_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 2000 & szn_stats_gr$Tm == "LAL"  & szn_stats_gr$Player != "Shaquille O'Neal*"),]
#shaq_teammates
shaq_gr <- mean(shaq_peak$GR)
shaq_team_gr <- mean(shaq_teammates$GR)
shaq_adjusted_gr <- shaq_gr - shaq_team_gr

hakeem_peak <- szn_stats_gr[which(szn_stats_gr$Player == "Hakeem Olajuwon*"),]
hakeem_peak <- hakeem_peak[which.max(hakeem_peak$GR),]
#hakeem_peak
hakeem_teammates <-szn_stats_gr[which(szn_stats_gr$Year == 1993 & szn_stats_gr$Tm == "HOU"  & szn_stats_gr$Player != "Hakeem Olajuwon*"),]
#hakeem_teammates
hakeem_gr <- mean(hakeem_peak$GR)
hakeem_team_gr <- mean(hakeem_teammates$GR)
hakeem_adjusted_gr <- hakeem_gr - hakeem_team_gr

player_enum <- c(1:16)
playeragrs <-  c(kobe_adjusted_gr, tmac_adjusted_gr, lebron_adjusted_gr, durant_adjusted_gr, jordan_adjusted_gr, barkley_adjusted_gr, chamberlain_adjusted_gr, russell_adjusted_gr, kareem_adjusted_gr, hayes_adjusted_gr, magic_adjusted_gr, bird_adjusted_gr, duncan_adjusted_gr, dirk_adjusted_gr, shaq_adjusted_gr, hakeem_adjusted_gr)
player_names <- c("kobe", "tmac", "lebron", "durant", "jordan", "barkley", "wilt", "russell", "kareem", "hayes", "magic", "bird", "duncan", "dirk", "shaq", "hakeem")
plot(playeragrs~player_enum, pch = 19, col = "red", ylab= "Adjusted GR", xlab="", main="Adjusted GR (Higher is better)" )
text(playeragrs~player_enum, labels=player_names, cex=0.9, font=2)
```
**


```{r}
#Potential GOATs ordered in descending GOAT Rating

goatorder <- szn_statsnb %>% arrange(desc(aGR))
goatorder <- goatorder[, c(1, 10)]
goatorder
```
